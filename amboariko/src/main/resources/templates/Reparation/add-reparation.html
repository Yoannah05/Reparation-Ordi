<div class="card shadow mb-4">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">Ajouter une Réparation</h6>
  </div>
  <div class="card-body">
    <form th:action="@{/reparations}" method="post">
      <!-- Sélection de l'ordinateur -->
      <div class="form-group">
        <label for="idOrdinateur">Ordinateur :</label>
        <select class="form-control" id="idOrdinateur" name="idOrdinateur" required>
          <option value="" disabled selected>Choisissez un ordinateur</option>
          <option th:each="ordinateur : ${ordinateurs}" th:value="${ordinateur.idOrdinateur}" th:text="${ordinateur.numeroSerie}"></option>
        </select>
      </div>

      <!-- Sélection des problèmes -->
      <div class="form-group">
        <label for="problemes">Problèmes :</label>
        <select class="form-control" id="problemes" name="problemes" multiple required>
          <option th:each="probleme : ${problemes}" th:value="${probleme.idProbleme}" th:text="${probleme.val}"></option>
        </select>
      </div>

      <!-- Sélection du type de réparation -->
      <div class="form-group">
        <label for="idTypeReparation">Type de réparation :</label>
        <select class="form-control" id="idTypeReparation" name="idTypeReparation" required>
          <option value="" disabled selected>Choisissez un type de réparation</option>
          <option th:each="type : ${typesReparation}" th:value="${type.idTypeRep}" th:text="${type.val}"></option>
        </select>
      </div>

      <!-- Sélection des composants avec quantité -->
      <div class="form-group">
        <label>Composants utilisés :</label>
        <div id="composants-container">
          <!-- Un champ vide pour ajouter dynamiquement des composants -->
          <div class="composant-item mb-2">
            <select class="form-control composant-select" name="composants[]" required>
              <option value="" disabled selected>Choisissez un composant</option>
              <option th:each="composant : ${composants}" th:value="${composant.idComposant}" th:text="${composant.nomComposant}"></option>
            </select>
            <input type="number" class="form-control quantite-input" name="quantites[]" placeholder="Quantité" min="1" required>
          </div>
        </div>
        <button type="button" class="btn btn-secondary mt-2" onclick="addComposantField()">
          <i class="fas fa-plus"></i> Ajouter un composant
        </button>
      </div>

      <!-- Date de début -->
      <div class="form-group">
        <label for="dateDebut">Date de début :</label>
        <input type="date" class="form-control" id="dateDebut" name="dateDebut" required>
      </div>

      <!-- Date de fin -->
      <div class="form-group">
        <label for="dateFin">Date de fin :</label>
        <input type="date" class="form-control" id="dateFin" name="dateFin">
      </div>

      <!-- Prix de la réparation -->
      <div class="form-group">
        <label for="prixReparation">Prix de la réparation :</label>
        <input type="number" class="form-control" id="prixReparation" name="prixReparation" step="0.01" required>
      </div>

      <!-- Statut de la réparation -->
      <div class="form-group">
        <label for="statut">Statut :</label>
        <select class="form-control" id="statut" name="statut" required>
          <option value="true">Terminée</option>
          <option value="false">En cours</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="idTechnicien">Technicien :</label>
        <select id="idTechnicien" name="idTechnicien">
          <option value="" th:selected="${selectedTechnicien == null}">Tous les techniciens</option>
          <option th:each="technicien : ${techniciens}"
                  th:value="${technicien.idTechnicien}"
                  th:text="${technicien.nom}"
              >
          </option>
      </select>
      </div>

      <div class="form-group">
        <label for="idCommission">Commission :</label>
        <input type="number" name="idCommission" id="idCommission" class="form-control" step="0.01" required>
      </div>

      <button type="submit" class="btn btn-primary">Ajouter</button>
    </form>
  </div>
</div>

<script th:inline="javascript">
    // Injecter la liste des composants dans une variable JavaScript
    const composants = /*[[${composants}]]*/ [];

    // Fonction pour ajouter dynamiquement un champ de composant avec quantité
    function addComposantField() {
        const container = document.getElementById("composants-container");

        const newItem = document.createElement("div");
        newItem.classList.add("composant-item", "mb-2");

        // Créer les options pour le select
        let options = '<option value="" disabled selected>Choisissez un composant</option>';
        composants.forEach(composant => {
            options += `<option value="${composant.idComposant}">${composant.nomComposant}</option>`;
        });

        // Ajouter le select et l'input de quantité
        newItem.innerHTML = `
            <select class="form-control composant-select" name="composants[]" required>
                ${options}
            </select>
            <input type="number" class="form-control quantite-input" name="quantites[]" placeholder="Quantité" min="1" required>
        `;

        // Ajouter le nouvel élément au conteneur
        container.appendChild(newItem);
    }
</script>